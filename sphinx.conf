#!/bin/sh
printf "
source repos {
    type = pgsql
    sql_host = postgres
    sql_user = postgres
    sql_pass = $HUBGREP_POSTGRES_PASSWORD
    sql_db = postgres
    sql_port = 5432
    sql_attr_uint = hosting_service_id
    sql_attr_uint = created_at
    sql_attr_uint = updated_at
    sql_attr_uint = pushed_at
    sql_attr_bool = is_fork
    sql_attr_bool = is_archived
    sql_attr_bool = is_mirror
    sql_attr_bool = is_empty
    sql_query = SELECT id, hosting_service_id, name, username, description, extract(epoch from created_at) as created_at, extract(epoch from updated_at) as updated_at, extract(epoch from pushed_at) as pushed_at, is_fork, is_archived, is_empty, is_mirror FROM new_repositories
}

index repos {
    source                  = repos
    path                    = /var/lib/sphinx/data/repos_index
    morphology              = stem_en
}

indexer {
    mem_limit               = 1024M
}

searchd {
    log                     = /var/log/sphinx.log
    query_log               = /var/log/sphinx-query.log
    pid_file                = /var/run/sphinx.pid
}
"
